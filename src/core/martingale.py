# trader.py
# Ø´Ø§Ù…Ù„ ØªÙˆØ§Ø¨Ø¹ Ø²ÛŒØ± Ø§Ø³Øª:
#   place_trade(command, reverse=False)
#       â†’ ÙØ±Ù…Ø§Ù† Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´ Ø±Ø§ Ø¨Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÛŒâ€ŒÙØ±Ø³ØªØ¯.
#   reverse_trade()
#       â†’ Ø¯Ø± ØµÙˆØ±Øª Ø¶Ø±Ø±ØŒ Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒÛŒ Ù…Ø¹Ú©ÙˆØ³ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
#   build_open_order()
#       â†’ Ø³Ø§Ø®Øª Ùˆ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ Ø¨Ø§Ø².
#   trade_counter Ùˆ order_counter
#       â†’ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÛŒ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡.
#   stop_loss Ùˆ profit_stop
#       â†’ Ú©Ù†ØªØ±Ù„ Ø¶Ø±Ø± Ùˆ Ø³ÙˆØ¯ Ú©Ù„.

# martingale.py
# Ø´Ø§Ù…Ù„ Ù…Ù†Ø·Ù‚ Ø²ÛŒØ± Ø§Ø³Øª:
#   calculate_next_amount()
#       â†’ Ù…Ø¨Ù„Øº Ù¾Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¶Ø±ÛŒØ¨ Ù…Ù†Ø¸Ù… (Û²ØŒ Û².ÛµØŒ ...)
#   reset_after_win()
#       â†’ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ø¨Ù„Øº Ø§ÙˆÙ„ÛŒÙ‡ Ù¾Ø³ Ø§Ø² Ø³ÙˆØ¯.
#   continue_after_loss()
#       â†’ Ø§Ø¯Ø§Ù…Ù‡ Ù¾Ù„Ù‡â€ŒÙ‡Ø§ Ø¯Ø± ØµÙˆØ±Øª ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÛŒ "Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² Ø­Ø¯ Ø¶Ø±Ø±".



"""
Ù…Ø§Ú˜ÙˆÙ„ MartingaleManager
------------------------
Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ù„Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ø±ØªÛŒÙ†Ú¯Ù„ØŒ Ø¶Ø±ÛŒØ¨ Ø±Ø´Ø¯ Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª Ù¾Ø³ Ø§Ø² Ø¨Ø±Ø¯.
"""

class MartingaleManager:
    def __init__(self, config):
        # Ù…Ù‚Ø¯Ø§Ø± Ù¾Ø§ÛŒÙ‡ Ù…Ø¹Ø§Ù…Ù„Ù‡ (Ø§ÙˆÙ„ÛŒÙ† Ù¾Ù„Ù‡)
        self.base_amount = 1
        # Ø¶Ø±ÛŒØ¨ Ø±Ø´Ø¯ (Û² = Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ø¯Ø± Ù‡Ø± Ø¨Ø§Ø®Øª)
        self.multiplier = config.get("martingale_step", 2)
        # Ø¢ÛŒØ§ Ù…Ø§Ø±ØªÛŒÙ†Ú¯Ù„ Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø§Ø®Øª Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø§Ø±Ø¯ØŸ
        self.continue_after_loss = config.get("continue_after_loss", True)

    def next_step(self, current_amount):
        """
        Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø§Ø®ØªØŒ Ù…Ø¨Ù„Øº Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¶Ø±ÛŒØ¨ Ø±Ø´Ø¯ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯.
        """
        if not self.continue_after_loss:
            return self.base_amount
        next_amount = current_amount * self.multiplier
        print(f"ğŸ” Ù…Ø§Ø±ØªÛŒÙ†Ú¯Ù„ ÙØ¹Ø§Ù„: Ù…Ø¨Ù„Øº Ø¨Ø¹Ø¯ÛŒ = {next_amount}")
        return next_amount

    def reset_amount(self):
        """
        Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ø¨Ù„Øº Ù¾Ø§ÛŒÙ‡ Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±Ø¯ ÛŒØ§ Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÛŒØ¯.
        """
        return self.base_amount